<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<head>
    <script src="js/neutralino.js"></script>
    <script src="js/main.js"></script>
    <script src="js/vue.js"></script>
    <!-- 引入样式 -->
    <link href="css/element-ui_theme-chalk_index.css" rel="stylesheet">

    <!-- 引入组件库 -->
    <script src="js/element-ui.js"></script>
    <script src="js/axios.js"></script>
    <script src="js/socket.io.js"></script>
</head>
<body>
<div id="vue">
    <el-container style="border: 1px solid #eee">
        <el-header style="text-align: left; font-size: 12px">
            调度器：
            <el-switch
                    v-model="scheduleState"

                    active-color="#13ce66"
                    inactive-color="#ff4949"
                    active-text="运行中"
                    inactive-text="暂停中"
                    @change="changeScheduleState($event)">
            </el-switch>
        </el-header>
        <el-container>

            <el-aside>
                <el-row class="tac">
                    <el-col :span="23">
                        <h5>默认颜色</h5>

                        <el-menu
                                :default-active="page"
                                class="el-menu-vertical-demo"
                                :default-openeds="openeds"
                                :collapse="isCollapse">

                            <el-menu-item index="1" @click="aside_click">
                                <i class="el-icon-s-home"></i>
                                <span slot="title">总览</span>
                            </el-menu-item>
                            <el-menu-item index="2" @click="aside_click">
                                <i class="el-icon-setting"></i>
                                <span slot="title">设置</span>
                            </el-menu-item>
                            <el-menu-item index="3" @click="aside_click">
                                <i class="el-icon-right"></i>
                                <span slot="title">作战</span>
                            </el-menu-item>

                            <el-submenu index="4">
                                <template slot="title">
                                    <i class="el-icon-date"></i>
                                    <span slot="title">自动化</span>
                                </template>
                                <el-menu-item index="4-1" @click="aside_click">收获</el-menu-item>
                                <el-menu-item index="4-2" @click="aside_click">战斗</el-menu-item>
                            </el-submenu>
                            <el-menu-item index="5" @click="aside_click">
                                <i class="el-icon-right"></i>
                                <span slot="title">公开招募</span>
                            </el-menu-item>
                        </el-menu>
                    </el-col>
                </el-row>
            </el-aside>

            <el-main>
                <div v-if="page=='1'">
                    <h3>总览</h3>

                    <el-card class="box-card" style="margin-bottom: 10px">
                        <p>时间:{{ time }}: 理智状态:{{ lizhi }}/{{ maxlizhi }}</p>
                        <div class="line"></div>
                        <div v-for="(key,index) in jobs">
                            <p>任务名称:{{ key.name }}。下次执行时间:{{ key.next_run_time }}</p>
                        </div>
                    </el-card>
                    <el-card class="box-card">
                        <div style="height:800px;overflow:auto;" ref="logContent">
                            <div v-for="i in log">
                                {{ i }}
                            </div>
                        </div>
                    </el-card>
                </div>
                <div v-if="page=='2'">
                    <h3>设置</h3>
                    <el-card class="box-card">
                        <div>
                            <el-button @click="alt_config">
                                编辑设置
                            </el-button>
                        </div>
                    </el-card>
                </div>
                <div v-if="page=='3'">
                    <h3>tips：</h3>
                    <p>地图名称(区分大小写)</p>
                    <p>地图类型(已支持主线，资源收集，剿灭，未适配作战)</p>
                    <p>剿灭无需输地图名称，会自动判断需要打的次数</p>
                    <p>未适配作战(需手动进入到作战前的界面)</p>
                    <p>参考:</p>
                    <p>CA = 技能书本&emsp;&emsp;LS = 经验本&emsp;&emsp;AP = 红票本&emsp;&emsp;SK = 碳本&emsp;&emsp;CE = 龙门币本</p>
                    <p>PR-A = 医疗重装芯片&emsp;&emsp;PR-B = 狙击术士芯片&emsp;&emsp;PR-C = 辅助先锋芯片&emsp;&emsp;PR-D = 近卫特种芯片</p>
                    <p>更新时间2021.10.25</p>
                    <el-link href="https://aog.wiki/" target="_blank">更多内容：https://aog.wiki/</el-link>

                    <el-card class="box-card">
                        <el-form ref="fight" :model="fight" label-width="100px">
                            <el-form-item label="地图名称">
                                <el-input v-model="fight.name"></el-input>
                            </el-form-item>
                            <el-form-item label="地图类型">
                                <el-radio-group v-model="fight.type">
                                    <el-radio label="主线" value="1"></el-radio>
                                    <el-radio label="资源收集" value="2"></el-radio>
                                    <el-radio label="剿灭" value="3"></el-radio>
                                    <el-radio label="活动" value="5"></el-radio>
                                    <el-radio label="未适配作战" value="4"></el-radio>
                                    <el-radio label="最近的作战" value="6"></el-radio>
                                </el-radio-group>
                            </el-form-item>
                            <el-form-item label="作战次数">
                                <el-input v-model="fight.times"></el-input>
                            </el-form-item>
                            <el-form-item label="附加选项">
                                <el-checkbox v-model="fight.use_medicine">使用理智药</el-checkbox>
                                <el-input v-model="fight.medicine_num" placeholder="0"></el-input>
                                <el-checkbox v-model="fight.use_stone">碎石</el-checkbox>
                                <el-input v-model="fight.stone_num" placeholder="0"></el-input>
                            </el-form-item>

                            </el-form-item>


                            <el-form-item>
                                <el-button type="primary" @click="fight_submit">立即执行</el-button>
                                <el-button @click="fight_cancel">取消</el-button>
                            </el-form-item>
                        </el-form>
                    </el-card>
                </div>
                <div v-if="page=='5'">
                    <h3>tips：</h3>
                    <p>遇到高姿需手动选择</p>
                    <p>请确保招聘许可和加急许可数量足够</p>
                    <p>请确保第一个位置在待招聘状态</p>
                    <el-card class="box-card">
                        <el-form ref="recruit" :model="recruit" label-width="100px">

                            <el-form-item label="招募次数">
                                <el-input v-model="recruit.times"></el-input>
                            </el-form-item>

                            <el-form-item>
                                <el-button type="primary" @click="recruit_submit">立即执行</el-button>
                            </el-form-item>
                        </el-form>
                    </el-card>
                </div>
                <div v-if="page=='4-1'">
                    <el-card class="box-card" style="margin-bottom: 10px">
                        <div slot="header">
                            <span>收获</span>
                        </div>
                        <el-row class="pad">

                            <el-switch
                                    v-model="job.receive_xinyong.state"
                                    active-color="#13ce66"
                                    inactive-color="#ff4949"
                                    active-text="开启收取信用"
                                    inactive-text="关闭收取信用"
                                    @change="state_change($event,'receive_xinyong')">
                            </el-switch>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','receive_xinyong')"
                                      v-model="job.receive_xinyong.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','receive_xinyong')"
                                      v-model="job.receive_xinyong.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <div class="line"></div>
                        <el-row class="pad">
                            <el-switch
                                    v-model="job.friend.state"
                                    active-color="#13ce66"
                                    inactive-color="#ff4949"
                                    active-text="开启访问好友"
                                    inactive-text="关闭访问好友"
                                    @change="state_change($event,'friend')">
                            </el-switch>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','friend')"
                                      v-model="job.friend.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','friend')"
                                      v-model="job.friend.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <el-row>
                            <div class="line"></div>
                            <el-row class="pad">
                                <el-switch
                                        v-model="job.receive_renwu.state"
                                        active-color="#13ce66"
                                        inactive-color="#ff4949"
                                        active-text="开启任务领取"
                                        inactive-text="关闭任务领取"
                                        @change="state_change($event,'receive_renwu')">
                                </el-switch>
                            </el-row>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','receive_renwu')"
                                      v-model="job.receive_renwu.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','receive_renwu')"
                                      v-model="job.receive_renwu.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <el-row>
                            <div class="line"></div>
                            <el-row class="pad">
                                <el-switch
                                        v-model="job.buy_xinyong_shop.state"
                                        active-color="#13ce66"
                                        inactive-color="#ff4949"
                                        active-text="开启信用商店购买"
                                        inactive-text="关闭信用商店购买"
                                        @change="state_change($event,'buy_xinyong_shop')">
                                </el-switch>
                            </el-row>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','buy_xinyong_shop')"
                                      v-model="job.buy_xinyong_shop.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','buy_xinyong_shop')"
                                      v-model="job.buy_xinyong_shop.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <el-row>
                            <div class="line"></div>
                            <el-row class="pad">
                                <el-switch
                                        v-model="job.recruit_daily.state"
                                        active-color="#13ce66"
                                        inactive-color="#ff4949"
                                        active-text="开启刷新选取公开招募"
                                        inactive-text="关闭刷新选取公开招募"
                                        @change="state_change($event,'recruit_daily')">
                                </el-switch>
                            </el-row>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','recruit_daily')"
                                      v-model="job.recruit_daily.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','recruit_daily')"
                                      v-model="job.recruit_daily.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                    </el-card>
                    <el-card class="box-card" style="margin-bottom: 10px">
                        <div slot="header">
                            <span>基建</span>
                        </div>
                        <el-row>
                            <el-row class="pad">
                                <el-switch
                                        v-model="job.jijian_receive.state"
                                        active-color="#13ce66"
                                        inactive-color="#ff4949"
                                        active-text="开启基建收获"
                                        inactive-text="关闭基建收获"
                                        @change="state_change($event,'jijian_receive')">
                                </el-switch>
                            </el-row>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','jijian_receive')"
                                      v-model="job.jijian_receive.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','jijian_receive')"
                                      v-model="job.jijian_receive.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <el-row>
                            <div class="line"></div>
                            <el-row class="pad">
                                <el-switch
                                        v-model="job.use_electricity.state"
                                        active-color="#13ce66"
                                        inactive-color="#ff4949"
                                        active-text="开启使用无人机"
                                        inactive-text="关闭使用无人机"
                                        @change="state_change($event,'use_electricity')">
                                </el-switch>
                            </el-row>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','use_electricity')"
                                      v-model="job.use_electricity.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','use_electricity')"
                                      v-model="job.use_electricity.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <el-row>
                            <div class="line"></div>
                            <el-row class="pad">
                                <el-switch
                                        v-model="job.clue.state"
                                        active-color="#13ce66"
                                        inactive-color="#ff4949"
                                        active-text="开启收获线索"
                                        inactive-text="关闭收获线索"
                                        @change="state_change($event,'clue')">
                                </el-switch>
                            </el-row>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','clue')"
                                      v-model="job.clue.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','clue')"
                                      v-model="job.clue.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                    </el-card>
                    <el-card class="box-card" style="margin-bottom: 10px">
                        <div slot="header">
                            <span>信息</span>
                        </div>
                        <el-row class="pad">

                            <el-switch
                                    v-model="job.get_lizhi.state"
                                    active-color="#13ce66"
                                    inactive-color="#ff4949"
                                    active-text="开启获取理智状态"
                                    inactive-text="关闭获取理智状态"
                                    @change="state_change($event,'get_lizhi')">
                            </el-switch>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','get_lizhi')"
                                      v-model="job.get_lizhi.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','get_lizhi')"
                                      v-model="job.get_lizhi.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <el-row class="pad">
                            <el-switch
                                    v-model="job.xinpian.state"
                                    active-color="#13ce66"
                                    inactive-color="#ff4949"
                                    active-text="开启自动填充芯片"
                                    inactive-text="关闭自动填充芯片"
                                    @change="state_change($event,'xinpian')">
                            </el-switch>
                        </el-row>
                        <el-row class="pad">
                            <span class="input">cron表达式：</span>
                            <el-input @change="trigger_change($event,'hour','xinpian')"
                                      v-model="job.xinpian.hour"
                                      class="input"
                                      placeholder="时">
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input @change="trigger_change($event,'minute','xinpian')"
                                      v-model="job.xinpian.minute"
                                      class="input"
                                      placeholder="分">
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                    </el-card>
                </div>
                <div v-if="page=='4-2'">
                    <el-card class="box-card" style="margin-bottom: 10px">
                        <div slot="header">
                            <span>添加任务</span>
                        </div>
                        <el-form ref="temp" :model="temp" label-width="100px">
                            <el-form-item label="任务唯一id(以fight_开头)">
                                <el-input v-model="temp.id">
                                </el-input>
                            </el-form-item>
                            <el-form-item label="地图名称">
                                <el-input v-model="temp.map_name"></el-input>
                            </el-form-item>
                            <el-form-item label="地图类型">
                                <el-radio-group v-model="temp.type">
                                    <el-radio label="主线" value="1"></el-radio>
                                    <el-radio label="资源收集" value="2"></el-radio>
                                    <el-radio label="剿灭" value="3"></el-radio>
                                    <el-radio label="活动" value="4"></el-radio>
                                    <el-radio label="最近的作战" value="5"></el-radio>

                                </el-radio-group>
                            </el-form-item>
                            <el-form-item label="作战次数">
                                <el-input v-model="temp.times"></el-input>
                            </el-form-item>
                            <el-form-item label="cron表达式">
                                <el-input class="input" v-model="temp.day_of_week">
                                    <template slot="prepend">星期(0-6)</template>
                                </el-input>
                                <el-input class="input" v-model="temp.hour">
                                    <template slot="prepend">时</template>
                                </el-input>
                                <el-input class="input" v-model="temp.minute">
                                    <template slot="prepend">分</template>
                                </el-input>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="add_fight_job">添加</el-button>
                            </el-form-item>
                        </el-form>
                    </el-card>
                    <el-card class="box-card" style="margin-bottom: 10px" v-for="(job,index) in fight_jobs">
                        <div slot="header">
                            <span>任务id：{{ job.id }}</span>
                        </div>
                        <el-row class="pad">

                            <el-switch
                                    v-model="job.state"
                                    active-color="#13ce66"
                                    inactive-color="#ff4949"
                                    active-text="开启任务"
                                    inactive-text="关闭任务"
                                    @change="state_change($event,job.id)">
                            </el-switch>
                        </el-row>
                        <el-row class="pad">
                            <el-input class="input" :value="job.map_name" disabled>
                                <template slot="prepend">地图名称</template>
                            </el-input>
                        </el-row>
                        <el-row class="pad">
                            <el-input class="input" :value="job.times" disabled>
                                <template slot="prepend">战斗次数</template>
                            </el-input>
                        </el-row>
                        <el-row class="pad">
                            <el-input class="input" :value="job.day_of_week" disabled>
                                <template slot="prepend">星期(0-6)</template>
                            </el-input>
                            <el-input class="input" v-model="job.hour" disabled>
                                <template slot="prepend">时</template>
                            </el-input>
                            <el-input class="input" v-model="job.minute" disabled>
                                <template slot="prepend">分</template>
                            </el-input>
                        </el-row>
                        <el-row class="pad">
                            <el-button type="danger" icon="el-icon-delete" @click="del_fight_job(job.id)">删除</el-button>
                        </el-row>
                        </el-form>
                    </el-card>
                </div>
            </el-main>
        </el-container>
    </el-container>
</div>

</body>

<script type="text/javascript">
    axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
    console.log(window.location.protocol + "//" + window.location.host)
    if (window.location.host == 5000) {
        base_url = window.location.protocol + "//" + window.location.host

    } else {
        base_url = 'http://127.0.0.1:5000'

    }
    user = "user"
    const vue = new Vue({
        el: "#vue",
        data() {
            return {
                scheduleState: true,
                isCollapse: false,
                page: "1",
                openeds: ['4'],
                time: "未获取",
                lizhi: "未获取",
                maxlizhi: "未获取",
                job: [],
                jobs: [],
                log: [],
                fight: {
                    name: '',
                    type: "",
                    times: "",
                    use_medicine: false,
                    medicine_num: 0,
                    use_stone: false,
                    stone_num: 0

                },
                temp: {
                    id: "",
                    map_name: "",
                    type: "",
                    times: "",
                    minute: "",
                    hour: "",
                    day_of_week: ""
                },
                fight_jobs: [],
                daily: {
                    enable: {
                        renwu: false,
                        friend: false,
                        xinyong: false,
                        jijian: {
                            receive: false,
                            use_electricity: false,
                            clue: false
                        }
                    },
                    jijian: {
                        a: 1,
                        b: 1
                    }
                },
                recruit: {
                    times: 0
                }
            }


        },
        watch: {
            log: {//深度监听，可监听到对象、数组的变化
                handler(val, oldVal) {
                    if (val.length > 500) {
                        this.log = this.log.slice(-400)

                        this.$nextTick(() => {
                            this.$refs.logContent.scrollTop = this.$refs.logContent.scrollHeight;
                        })
                    }
                    this.$refs.logContent.scrollTop = this.$refs.logContent.scrollHeight;
                },
                deep: true //true 深度监听
            },
            job: {//深度监听，可监听到对象、数组的变化
                handler(val, oldVal) {
                    if (val.length > 500) {
                        this.log = this.log.slice(-400)
                    }
                },
                deep: true //true 深度监听
            },
        },
        methods: {
            alt_config() {
                axios({
                    method: 'get',
                    url: base_url + "/alt_config"
                }).then(e => {

                })
            },
            changeScheduleState(state) {
                if (!state)
                    a = "/pause_scheduler"
                else
                    a = "/resume_scheduler"
                loadingObj = this.addLive()
                axios({
                    method: 'get',
                    url: base_url + a,
                    data: {}
                }).then((response) => {
                    console.info(response.data.result)
                    if (response.data.result === "运行中") {
                        vue.$data.scheduleState = true
                    } else {
                        console.info("暂停中")
                        vue.$data.scheduleState = false
                    }

                })
                loadingObj.close();
                this.$message({
                    message: '操作成功',
                    type: 'success'
                });
            },

            aside_click(key) {
                this.page = key.index;
            },
            fight_submit() {
                loadingObj = this.addLive()
                axios({
                    method: 'post',
                    url: base_url + '/fight',
                    data: {'fight': this.fight},
                })
                    .then((response) => {
                        console.log(response.data.result)
                    })
                    .catch((error) => {
                        console.log(error)
                    })

                loadingObj.close();
                this.$message({
                    message: '操作成功',
                    type: 'success'
                });
            },
            recruit_submit() {
                loadingObj = this.addLive()
                axios({
                    method: 'post',
                    url: base_url + '/recruit',
                    data: {'recruit': this.recruit},
                })
                    .then((response) => {
                        console.log(response.data.result)
                    })
                    .catch((error) => {
                        console.log(error)
                    })

                loadingObj.close();
                this.$message({
                    message: '操作成功',
                    type: 'success'
                });
            },
            fight_cancel() {

            }
            ,
            reschedule_job() {
                loadingObj = this.addLive()
                axios({
                    method: 'post',
                    url: base_url + '/reschedule_job',
                    data: {'job': this.fight},
                })
                    .then((response) => {
                        console.log(response.data.result)
                    })
                    .catch((error) => {
                        console.log(error)
                    })
                loadingObj.close();
            }
            ,
            //函数中使用可以防止双击
            addLive() {
                return this.$loading({
                    lock: true,
                    text: '提交中....',
                    spinner: 'el-icon-loading',
                    background: 'rgba(0,0,0,0.7)',
                    target: document.querySelector('.submit-test-dialog')
                })
            },
            state_change(state, name) {
                console.log(state, name)
                loadingObj = this.addLive()
                axios({
                    method: 'post',
                    url: base_url + '/pause_or_resume',
                    data: {
                        name: name,
                        state: state
                    }
                }).then((response) => {
                    //更新任务列表
                    axios({
                        method: 'get',
                        url: base_url + '/get_jobs'
                    })
                        .then((response) => {
                            console.log("get_jobs:")
                            console.log(response.data.result)
                            vue.$data.jobs = response.data.result

                        })

                })


                loadingObj.close();
                this.$message({
                    message: '操作成功',
                    type: 'success'
                });
            },
            trigger_change(value, kind, name) {
                console.log(value, kind, name)
                loadingObj = this.addLive()
                axios({
                    method: 'post',
                    url: base_url + '/trigger_change',
                    data: {
                        value: value,
                        kind: kind,
                        name: name
                    }
                }).then((response) => {
                    //更新任务列表
                    axios({
                        method: 'get',
                        url: base_url + '/get_jobs'
                    })
                        .then((response) => {
                            console.log("get_jobs:")
                            console.log(response.data.result)
                            vue.$data.jobs = response.data.result

                        })

                })


                loadingObj.close();
                this.$message({
                    message: '操作成功',
                    type: 'success'
                });
            },
            add_fight_job() {
                loadingObj = this.addLive()
                axios({
                    method: 'post',
                    url: base_url + '/add_fight_job',
                    data: {
                        fight: this.temp
                    }
                }).then((response) => {
                    if (response.data.result == "id不符合格式") {
                        this.$message({
                            message: '操作失败',
                            type: 'error'
                        });
                    } else {
                        this.$message({
                            message: '操作成功',
                            type: 'success'
                        });
                        //更新任务列表
                        axios({
                            method: 'get',
                            url: base_url + '/get_jobs'
                        })
                            .then((response) => {
                                console.log("get_jobs:")
                                console.log(response.data.result)
                                vue.$data.jobs = response.data.result

                            })
                        axios({
                            method: 'get',
                            url: base_url + '/get_fight_jobs'
                        })
                            .then((response) => {
                                console.log("get_fight_jobs:")
                                console.log(response.data.result)
                                vue.$data.fight_jobs = response.data.result

                            })
                    }


                })


                loadingObj.close();

            },
            del_fight_job(id) {
                loadingObj = this.addLive()
                axios({
                    method: 'post',
                    url: base_url + '/del_fight_job',
                    data: {
                        id: id
                    }
                }).then((response) => {

                    this.$message({
                        message: '操作成功',
                        type: 'success'
                    });
                    //更新任务列表
                    axios({
                        method: 'get',
                        url: base_url + '/get_jobs'
                    })
                        .then((response) => {
                            console.log("get_jobs:")
                            console.log(response.data.result)
                            vue.$data.jobs = response.data.result

                        })
                    axios({
                        method: 'get',
                        url: base_url + '/get_fight_jobs'
                    })
                        .then((response) => {
                            console.log("get_fight_jobs:")
                            console.log(response.data.result)
                            vue.$data.fight_jobs = response.data.result

                        })


                })


                loadingObj.close();
            }

        },
        mounted() {
            setTimeout(function mounted_() {
                axios({
                    method: 'get',
                    url: base_url + "/is_scheduler_running",
                    data: {}
                }).then((response) => {
                    if (response.data.result === "运行中")
                        this.scheduleState = true
                    else
                        this.scheduleState = false
                    console.info(this.scheduleState)
                })
                namespace = "/dcenter"
                var socket = io.connect(base_url + namespace)
                socket.on('dcenter', function (res) {
                    var t = res.data
                    if (t) {
                        vue.$data.log.push(t)
                    }
                    console.log(t)
                });
            }, 10000);

        },
        created() {
            setTimeout(function created_() {
                function getState() {
                    //获取理智
                    axios({
                        method: 'get',
                        url: base_url + '/lizhi'
                    })
                        .then((response) => {
                            console.log(response.data.result)
                            vue.$data.lizhi = response.data.result["lizhi"]
                            vue.$data.maxlizhi = response.data.result["maxlizhi"]
                            vue.$data.time = response.data.result["time"]
                        })
                        .catch((error) => {
                            console.log(error)
                        })
                    //获取任务列表
                    axios({
                        method: 'get',
                        url: base_url + '/get_jobs'
                    })
                        .then((response) => {
                            console.log("get_jobs:")
                            console.log(response.data.result)
                            vue.$data.jobs = response.data.result

                        })
                        .catch((error) => {
                            console.log(error)
                        })
                    //根据任务id获取任务
                    axios({
                        method: 'post',
                        url: base_url + '/get_job',
                        data: {
                            ids: {
                                "receive_renwu": {},
                                "get_lizhi": {},
                                "jijian_receive": {},
                                "use_electricity": {},
                                "friend": {},
                                "receive_xinyong": {},
                                "buy_xinyong_shop": {},
                                "recruit_daily": {},
                                "xinpian": {},
                                "clue": {},
                            }
                        },
                    })
                        .then((response) => {
                            console.log("get_job:")
                            console.log(JSON.stringify(response.data.result))
                            vue.$data.job = response.data.result

                        })
                        .catch((error) => {
                            console.log(error)
                        })
                    //获取作战任务列表
                    axios({
                        method: 'get',
                        url: base_url + '/get_fight_jobs'
                    })
                        .then((response) => {
                            console.log("get_fight_jobs:")
                            console.log(response.data.result)
                            vue.$data.fight_jobs = response.data.result

                        })
                        .catch((error) => {
                            console.log(error)
                        })
                }

                getState()
                window.setInterval(() => {
                    setTimeout(() => {
                        getState()
                    }, 0)
                }, 5 * 60 * 1000)
            }, 10000);

        }
    })

</script>

<style>

    .el-menu-vertical-demo:not(.el-menu--collapse) {
        width: 200px;
        min-height: 400px;
    }

    .pad {
        padding: 5px;
        margin-bottom: 5px;
    }

    .input {
        width: 200px;
        float: left;
        margin-right: 10px
    }

    .line {
        margin: 10px;
        border-bottom: 1px solid #ccc

    }
</style>
</html>